<!DOCTYPE html>
<html>
  <head>
    <%- include('partials/extHeader.ejs') %>
		<title>Apple Daily Deluxe</title>
    <%- include('partials/googleAdTag.ejs', {adTag: 'Index'}) %>
    <link rel="stylesheet" href="/css/common.css" />
  </head>
  <body>
    <div ng-app="addv2" ng-controller="HomepageController">
      <top-menu ng-categories="categories"></top-menu>
      <%- include('partials/mpms.ejs', {mpms: mpms}) %>
      <latest-articles add-articles="latestArticles"></latest-articles>
      <highlights-block add-highlights="highlights"></highlights-block>
      <latest-articles add-articles="secLatestArticles"></latest-articles>
      <editor-picks add-picks="editorPicks"></editor-picks>
      <instagram-medias ig-medias="igMedias"></instagram-medias>
    </div>
    <h3>Example DFP advertisement</h3>
 	  <div>
 	    <script>
 	      googletag.cmd.push(function() {
 	         googletag.display("adHeaderTop");
 	      });
 	    </script>
 	  </div>
    <script src="/bundle.js"></script>

  <div class="nm_v_menu visible-xs" vmenu="content">
    <div inc='inc/mobile_menu.html'></div>
  </div>
  <div class="container nm_home">
    <div inc='inc/header.html'></div>
    <div class="row nm_row">
      <!--<div class="skinner_ad" skinner_ad_left></div>-->
      <div class="main_content">
        <div class="nm_section">
          <div class="head_banner_wrapper">
            <div class="superhead_banner"></div>
            <div class="head_banner"></div>
          </div>
          <div class="row nm_row">
            <div class="pull-right lrec_ad_wrapper hidden-xs">
              <div class="lrec_ad_large"></div>
              <div class="lrec_ad_small"></div>
            </div>
            <div class="pull-right nm_mpm col-xs-12">
              <div class="mpm_content" inc='inc/home_slideshow.html'>
              </div>
            </div>
          </div>
        </div>

        <div inc='inc/home_contributors.html'></div>
        <div inc='inc/home_facebook.html'></div>
        <div inc='inc/home_highlight.html' loading="content"></div>
        <div class="nm_section" loading="content">
          <div class="head_banner_wrapper">
            <div class="superhead_banner"></div>
            <div class="head_banner"></div>
          </div>
        </div>
        <div inc='inc/home_instagram.html' loading="content"></div>
        <div inc='inc/home_events.html' loading="content"></div>
        <div inc='inc/home_editors_picks.html' loading="content"></div>
        <div class="nm_section" loading="content">
          <div class="head_banner_wrapper">
            <div class="superhead_banner"></div>
            <div class="head_banner"></div>
          </div>
        </div>
        <div class="nm_section" loading="trigger">
          <div class="text-center">Loading...</div>
        </div>
      </div>
      <!--<div class="skinner_ad" skinner_ad_right></div>-->
    </div>

    <div inc='inc/footer.html'></div>
    <div inc="inc/newsletter.html"></div>
  </div>

  <script>
    $(document).ready(function() {
      $('[inc]').each(function() {
        var $this = $(this);
        var url = $this.attr('inc');
        if ($this.attr('loading') != "content")
          $this.load(url);
      });


      // lazy load
      var $loadingTrigger = $('[loading="trigger"]').first();
      var isLoading = false;
      var loadingIndex = 0;
      if ($loadingTrigger.length > 0) {
        $loadingContents = $('[loading="content"]');
        $loadingContents.addClass('hidden');
        $(document).on('scroll', function() {
          if ($(window).height() + $(document).scrollTop() > $loadingTrigger.position().top &&
            $loadingContents.length > loadingIndex &&
            !isLoading) {
            isLoading = true;
            // console.log('start');
            var $content = $($loadingContents.get(loadingIndex));
            var url = $content.attr('inc');
            $content.attr('loading', 'loaded');
            $content.removeClass('hidden');
            if (url) {
              $content.load(url, function() {
                isLoading = false;
                // console.log('complete');
              });
            } else {
              isLoading = false;
            }
            loadingIndex++;
          } else if ($loadingContents.length <= loadingIndex) {
            $loadingTrigger.addClass('hidden');
          }
        });
      }
    });


    // $(document).ready(function(){
    // 	var $skinnerAdRight = $('[skinner_ad_right]');
    // 	var $skinnerAdLeft = $('[skinner_ad_left]');
    // 	var $skinnerAdRightContainer = $skinnerAdRight.parent();
    // 	var updateSkinnerAd = function(){

    // 		if ($(document).scrollTop() >= 170){
    // 			$('.skinner_ad').addClass('fixed');
    // 			var offset = $(document).width() - $('body').width();
    // 			// console.log(offset);
    // 			$skinnerAdRight.css('right', ($(document).width() - ($skinnerAdRightContainer.position().left + $skinnerAdRightContainer.width())) - (offset > 0 ? offset - $(document).scrollLeft() : 0 ));
    // 			if (offset > 0){
    // 				$skinnerAdLeft.css('left', - $(document).scrollLeft());
    // 			}
    // 			else{
    // 				$skinnerAdLeft.attr('style', 'left:auto');
    // 			}
    // 		}
    // 		else{
    // 			$('.skinner_ad').removeClass('fixed');
    // 			$skinnerAdRight.css('right', '0px');
    // 			$skinnerAdLeft.css('left', '0px');
    // 		}
    // 	}
    // 	updateSkinnerAd();
    // 	$(document).on('scroll', updateSkinnerAd);
    // });

    $(document).ready(function() {
      $('.newsletter_small').hide();
      $('.newsletter_close').click(function() {
        $('.newsletter').hide();
        $('.newsletter_small').show();
      });
      $('.newsletter_small').click(function() {
        $('.newsletter').show();
      });
    });
  </script>
  </body>
</html>

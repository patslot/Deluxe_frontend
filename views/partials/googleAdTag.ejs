<script src="https://www.googletagservices.com/tag/js/gpt.js">
</script>
<script>
var adPrefixTag = '<%= AD_PREFIX_TAG %>';
var webTags = [];
var mobileTags = [];

if (adPrefixTag !== "") {
  webTags.push(adPrefixTag);
  mobileTags.push(adPrefixTag);
}

webTags.push('<%= AD_WEB_BASE_TAG %>');
webTags.push('<%= adTag %>');

mobileTags.push('<%= AD_MOBILE_BASE_TAG %>');
mobileTags.push('<%= adTag %>');

var webPrefix = "/" + webTags.join("/") + "/";
var webSlotSizes = {
  HeadBanner: [[970, 90], [970, 160], [970, 250]],
  LREC1: [[300, 250], [300, 430], [300, 600]],
  LREC2: [[300, 250], [300, 430], [300, 600]],
  Midbanner: [[970, 90], [970, 160], [970, 250]],
  Skyscraper1: [[120, 600], [160, 600]],
  Skyscraper2: [[120, 600], [160, 600]]
};

var mobilePrefix = "/" + mobileTags.join("/") + "/";
var mobileSlotSizes = {
  Fixedbanner1: [[320, 80], [320, 360], [300, 250]],
  Fixedbanner2: [[320, 80], [320, 360], [300, 250]],
  Fixedbanner3: [[320, 80], [320, 360], [300, 250]],
  Fixedbanner4: [[320, 80], [320, 360], [300, 250]],
  SplashAd: [[320, 460], [320, 480], [320, 548]]
};

if (window.googletag && googletag.apiReady) {
  googletag.cmd.push(function() {
    googletag.pubads().collapseEmptyDivs();
    googletag.pubads().enableSingleRequest();
    googletag.pubads().disableInitialLoad();
    googletag.enableServices();
  });
}

var webAdDisplayed = {};
var webAdSlots = {};
var webAdDivIds = [];

var mobileAdDisplayed = {};
var mobileAdSlots = {};
var mobileAdDivIds = [];

function displayAd(divId, slot) {
  googletag.display(divId);
  googletag.pubads().refresh([slot]);
}

function showWebAd(adType, divId) {
  if (window.googletag && googletag.apiReady) {
    googletag.cmd.push(function() {
      var slot = googletag
        .defineSlot(
          webPrefix + adType,
          webSlotSizes[adType],
          divId)
        .addService(googletag.pubads());
      webAdSlots[divId] = slot;
      webAdDivIds.push(divId);
      if ($("#" + divId).is(":visible")) {
        displayAd(divId, slot);
        webAdDisplayed[divId] = true;
      } else {
        webAdDisplayed[divId] = false;
      }
    });
  }
}

function showMobileAd(adType, divId) {
  if (window.googletag && googletag.apiReady) {
    googletag.cmd.push(function() {
      var slot = googletag
        .defineSlot(
          mobilePrefix + adType,
          mobileSlotSizes[adType],
          divId)
        .addService(googletag.pubads());
      mobileAdSlots[divId] = slot;
      mobileAdDivIds.push(divId);
      if ($("#" + divId).is(":visible")) {
        displayAd(divId, slot);
        mobileAdDisplayed[divId] = true;
      } else {
        mobileAdDisplayed[divId] = false;
      }
    });
  }
}

$(document).ready(function() {
  $(window).on("resize", function() {
    for (var i = 0; i < webAdDivIds.length; i++) {
      if ($("#" + webAdDivIds[i]).is(":visible") && !webAdDisplayed[webAdDivIds[i]]) {
        displayAd(webAdDivIds[i], webAdSlots[webAdDivIds[i]]);
        webAdDisplayed[webAdDivIds[i]] = true;
      }
    }
    for (var i = 0; i < mobileAdDivIds.length; i++) {
      if ($("#" + mobileAdDivIds[i]).is(":visible") && !mobileAdDisplayed[mobileAdDivIds[i]]) {
        displayAd(mobileAdDivIds[i], mobileAdSlots[mobileAdDivIds[i]]);
        mobileAdDisplayed[mobileAdDivIds[i]] = true;
      }
    }
  });
});
</script>
